<script>
(function(){
  // === Tus videos ===
  const LEFT_VIDEOS  = ["bG5kLiHUqps","WYs4CVCk0VY","SzifIQH0DvM","K2qWjAxmng8","sSu4GRr4OfA"];
  const RIGHT_VIDEOS = ["5EqRXSvToAU","zEwEcDToCv0","0pymj3yG7C4","EqJeIEEUuXE","pldK8RHRsHE"];

  const corridor = document.getElementById('corridor');
  const cameraEl = document.getElementById('camera');
  const scene = document.getElementById('scene');

  const spacingZ = 1400;
  const doorX    = 520;

  const panels = [];

  function makePanel(side, index, id){
    const el = document.createElement('div');
    el.className = 'panel';
    const z = -index * spacingZ;
    const x = (side === 'L' ? -doorX : doorX);
    const rotY = (side === 'L' ? 90 : -90);
    el.style.transform = `translate3d(${x}px,0,${z}px) rotateY(${rotY}deg)`;
    el.dataset.z = z;

    const src = `https://www.youtube.com/embed/${id}?autoplay=1&mute=1&controls=0&loop=1&playlist=${id}&playsinline=1&modestbranding=1&rel=0`;
    const ifr = document.createElement('iframe');
    ifr.allow = "autoplay; encrypted-media; picture-in-picture; fullscreen";
    ifr.src = src;
    el.appendChild(ifr);

    scene.appendChild(el);
    panels.push(el);
  }

  const count = Math.max(LEFT_VIDEOS.length, RIGHT_VIDEOS.length);
  for(let i=0;i<count;i++){
    makePanel('L', i, LEFT_VIDEOS[i % LEFT_VIDEOS.length]);
    makePanel('R', i, RIGHT_VIDEOS[i % RIGHT_VIDEOS.length]);
  }

  // ==== Movimiento continuo ====
  let cameraZ = 0;     // posición actual
  let speedZ  = 0;     // velocidad
  let yaw=0,pitch=0,roll=0,strafe=0;
  let targetYaw=0,targetPitch=0,targetRoll=0,targetStrafe=0;

  const look = { maxYawDeg:10, maxPitchDeg:6, maxRollDeg:3, strafe:90, ease:0.08 };

  // Input: scroll/flechas = impulsos de velocidad
  function onWheel(e){ speedZ += -e.deltaY * 0.2; }
  function onKey(e){
    const k = e.key.toLowerCase();
    if (k==='arrowup' || k==='w') speedZ -= 40;
    if (k==='arrowdown' || k==='s') speedZ += 40;
  }
  corridor.addEventListener('wheel', onWheel,{passive:true});
  window.addEventListener('keydown', onKey);

  // Mouse: head tracking
  window.addEventListener('mousemove', e=>{
    const rect = corridor.getBoundingClientRect();
    const nx = (e.clientX-rect.left)/rect.width*2-1;
    const ny = (e.clientY-rect.top)/rect.height*2-1;
    targetYaw   = -nx*look.maxYawDeg;
    targetPitch =  ny*look.maxPitchDeg;
    targetRoll  = -nx*look.maxRollDeg;
    targetStrafe=  nx*look.strafe;
  });

  // Animación
  function animate(){
    // avanzar con inercia
    cameraZ += speedZ;
    speedZ *= 0.92; // fricción

    // easing de cámara (rotación/parallax)
    yaw     += (targetYaw   - yaw)   * look.ease;
    pitch   += (targetPitch - pitch) * look.ease;
    roll    += (targetRoll  - roll)  * look.ease;
    strafe  += (targetStrafe- strafe)* look.ease;

    cameraEl.style.transform =
      `translate3d(${strafe}px,0,0) rotateX(${pitch}deg) rotateY(${yaw}deg) rotateZ(${roll}deg)`;
    scene.style.transform = `translateZ(${cameraZ}px)`;

    // reciclar paneles
    for(const p of panels){
      let z = parseFloat(p.dataset.z);
      if (z + cameraZ > 800){
        z -= spacingZ * count;
        p.dataset.z = z;
        const side = panels.indexOf(p)%2===0 ? 'L':'R';
        const rotY = (side==='L'?90:-90);
        const x = (side==='L'?-doorX:doorX);
        p.style.transform = `translate3d(${x}px,0,${z}px) rotateY(${rotY}deg)`;
      }
    }
    requestAnimationFrame(animate);
  }
  animate();
})();
</script>
